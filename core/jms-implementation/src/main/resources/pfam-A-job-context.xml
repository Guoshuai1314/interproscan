<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">

    <!-- TODO

     In this implementation, have extended Step for specific types of Step.

     This keeps the XML file quite simple, not too many beans referencing each other.

     Otherwise, could define as separate interface for the specifics of each step
     type (favouring


         TODO -->

    <!-- ######################## Queues ############################  -->
    <bean id="parallelTaskSubmissionQueue" class="uk.ac.ebi.interpro.scan.management.model.Queue">
        <property name="name"                               value="taskSubmissionQueue"/>
    </bean>

    <!-- TODO - Playing around with ideas - additional queue for 'serial' tasks like persistence?
         TODO - Or just use message filtering?                                 -->
    <bean id="serialTaskSubmissionQueue" class="uk.ac.ebi.interpro.scan.management.model.Queue">
        <property name="name"                               value="persistenceSubmissionQueue"/>
    </bean>
    <!-- !!!!!!!!!!!!!!!!!!!!!!!! Queues-END !!!!!!!!!!!!!!!!!!!!!!!!!!!!!  -->

    <!-- ######################## JOB: Pfam-A ############################  -->
    <bean id="job_pfam_A" class="uk.ac.ebi.interpro.scan.management.model.Job">
        <property name="description"                        value="Pfam HMMER3 Raw Analysis and Post Processing"/>
    </bean>


    <!-- STEP 1 -->
    <bean id="step_pfam_A_write_fasta_file"                 class="uk.ac.ebi.interpro.scan.management.model.implementations.WriteFastaFileStep">
        <property name="job"                                ref="job_pfam_A"/>
        <!-- This step has no depdencies, so will be scheduled first for its associated job. -->
        <property name="stepDescription"                    value="If it is not already available on the path, write the appropriate fasta file."/>
        <property name="createStepInstancesForNewProteins"  value="true"/>
        <property name="queue"                              ref="parallelTaskSubmissionQueue"/>
        <property name="id"                                 value="step_pfam_A_write_fasta_file"/>
        <property name="retries"                            value="0"/>
        <property name="fastaFilePathTemplate"
                  value="/ebi/sp/pro1/interpro/programmers/pjones/test/hmmer_output_[PROTSTART]_[PROTEND].fasta"/>
    </bean>

    <!-- STEP 2 -->
    <bean id="step_pfam_A_run_HMMER3"                       class="uk.ac.ebi.interpro.scan.management.model.implementations.hmmer3.RunHmmer3Step">
        <property name="job"                                ref="job_pfam_A"/>

        <property name="dependsUpon"                        ref="step_pfam_A_write_fasta_file"/>
        <property name="stepDescription"                    value="Run HMMER 3 Binary for selected proteins"/>
        <property name="createStepInstancesForNewProteins"  value="true"/>
        <property name="queue"                              ref="parallelTaskSubmissionQueue"/>

        <property name="fullPathToBinary"                   value="/ebi/production/interpro/binaries/64_bit_Linux/HMMER3.0b2/hmmscan"/>
        <property name="binarySwitches"                     value="--cutga"/>
        <property name="fullPathToHmmFile"                  value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.hmm"/>
        <property name="hmmerOutputFilePathTemplate"        value="/ebi/sp/pro1/interpro/programmers/pjones/test/hmmer_output_[PROTSTART]_[PROTEND]"/>
        <property name="id"                                 value="step_pfam_A_run_HMMER3"/>
        <property name="retries"                            value="0"/>
        <property name="fastaFilePathNameTemplate"
                  value="/ebi/sp/pro1/interpro/programmers/pjones/test/hmmer_output_[PROTSTART]_[PROTEND].fasta"/>
    </bean>

    <!-- STEP 3 -->
    <bean id="step_pfam_A_parse_HMMER3_output"              class="uk.ac.ebi.interpro.scan.management.model.implementations.hmmer3.ParseHMMER3OutputStep">
        <property name="job"                                ref="job_pfam_A"/>

        <property name="dependsUpon"                        ref="step_pfam_A_run_HMMER3"/>
        <property name="stepDescription"                    value="Parse the output from HMMER3"/>
        <property name="createStepInstancesForNewProteins"  value="true"/>
        <property name="queue"                              ref="serialTaskSubmissionQueue"/>

        <property name="id" value="step_pfam_A_parse_HMMER3_output"/>
        <property name="hmmerOutputFilePathTemplate"        value="/ebi/sp/pro1/interpro/programmers/pjones/test/hmmer_output_[PROTSTART]_[PROTEND]"/>
        <property name="fullPathToHmmFile"                  value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.hmm"/>
        <property name="retries"                            value="0"/>
    </bean>

    <!-- STEP 4 -->
    <bean id="step_pfam_A_post_processing"                  class="uk.ac.ebi.interpro.scan.management.model.implementations.hmmer3.PfamA.Pfam_A_PostProcessingStep">
        <property name="job"                                ref="job_pfam_A"/>

        <property name="dependsUpon"                        ref="step_pfam_A_parse_HMMER3_output"/>
        <property name="stepDescription"                    value="Performs post processing on Pfam data (Hmmer 3 based)"/>
        <property name="createStepInstancesForNewProteins"  value="true"/>
        <property name="queue"                              ref="serialTaskSubmissionQueue"/>
        <property name="id"                                 value="step_pfam_A_post_processing"/>
        <property name="retries"                            value="0"/>
        <property name="postProcessor"                      ref="pfam_A_post_processor"/>
    </bean>
    <!-- !!!!!!!!!!!!!!!!!!!!! JOB-END: Pfam-A !!!!!!!!!!!!!!!!!!!!!!!!!!!!  -->

    <!-- ######################## Dependencies ############################  -->
    <bean id="pfam_A_post_processor"                        class="uk.ac.ebi.interpro.scan.business.postprocessing.pfam_A.PfamHMMER3PostProcessing">
        <property name="clanFileParser"                     ref="pfam_A_clanFileParser"/>
    </bean>

    <bean id="pfam_A_clanFileParser"                        class="uk.ac.ebi.interpro.scan.business.postprocessing.pfam_A.ClanFileParser">
        <property name="pfamASeedFile"                      value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.seed"/>
        <property name="pfamCFile"                          value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-C"/>
    </bean>
    <!-- !!!!!!!!!!!!!!!!!!!!! Dependencies-END !!!!!!!!!!!!!!!!!!!!!!!!!!!!  -->
</beans>
