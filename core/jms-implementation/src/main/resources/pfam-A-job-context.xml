<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                           http://www.springframework.org/schema/aop
                           http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
                           http://www.springframework.org/schema/tx
                           http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">

    <!-- TODO

     In this implementation, have extended Step for specific types of Step.

     This keeps the XML file quite simple, not too many beans referencing each other.

     Otherwise, could define as separate interface for the specifics of each step
     type (favouring


         TODO -->

    <import resource="persistence-config.xml"/>

    <!-- ######################## JOB: Pfam-A ############################  -->
    <bean id="job_pfam_A" class="uk.ac.ebi.interpro.scan.management.model.Job">
        <property name="description"                        value="Pfam HMMER3 Raw Analysis and Post Processing"/>
    </bean>

    <bean id="abstract_pfam_A_step" abstract="true" class="uk.ac.ebi.interpro.scan.management.model.Step">
         <property name="job"                                ref="job_pfam_A"/>
         <property name="maxProteins"                        value="5000"/>
         <property name="createStepInstancesForNewProteins"   value="true"/>
         <property name="retries"                            value="0"/>
    </bean>

    <!-- STEP 1 -->
    <bean id="step_pfam_A_write_fasta_file"
          class="uk.ac.ebi.interpro.scan.management.model.implementations.WriteFastaFileStep"
          parent="abstract_pfam_A_step">
        <!-- This step has no dependencies, so will be scheduled first for its associated job. -->
        <property name="stepDescription"                    value="Create fasta file."/>
        <property name="fastaFileNameTemplate"              value="seq_[PROTSTART]_[PROTEND].fasta"/>
        <!--<property name="serialGroup"                        value="WRITE_FASTA_FILE"/>-->
        <property name="proteinDAO"                         ref="proteinDAO"/>
    </bean>

    <!-- STEP 2 -->
    <bean id="step_pfam_A_run_HMMER3"
          class="uk.ac.ebi.interpro.scan.management.model.implementations.hmmer3.RunHmmer3Step"
          parent="abstract_pfam_A_step">
        <property name="dependsUpon"                        ref="step_pfam_A_write_fasta_file"/>
        <property name="stepDescription"                    value="Run HMMER 3 Binary for selected proteins"/>
        <property name="fullPathToBinary"                   value="/ebi/production/interpro/binaries/64_bit_Linux/HMMER3.0b2/hmmsearch"/>
        <property name="binarySwitches" >
            <list>
                <value>-Z</value>
                <value>9421015</value>
                <value>--cut_ga</value>
            </list>
        </property>
        <property name="fullPathToHmmFile"                  value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.hmm"/>
        <property name="hmmerOutputFileNameTemplate"        value="hmmer_output_[PROTSTART]_[PROTEND]"/>
        <property name="fastaFileNameTemplate"              value="seq_[PROTSTART]_[PROTEND].fasta"/>
    </bean>

    <bean id="step_pfam_A_delete_fasta_file"
          class="uk.ac.ebi.interpro.scan.management.model.implementations.DeleteFileStep"
          parent="abstract_pfam_A_step">
        <property name="dependsUpon"                        ref="step_pfam_A_run_HMMER3"/>
        <property name="stepDescription"                    value="Delete the fasta file following successful run of HMMER3"/>
        <property name="fileNameTemplate"                   value="seq_[PROTSTART]_[PROTEND].fasta"/>
    </bean>

    <!-- STEP 3 -->
    <bean id="step_pfam_A_parse_HMMER3_output"
          class="uk.ac.ebi.interpro.scan.management.model.implementations.hmmer3.PfamA.ParsePfam_A_HMMER3OutputStep"
          parent="abstract_pfam_A_step">
        <property name="dependsUpon"                        ref="step_pfam_A_run_HMMER3"/>
        <property name="stepDescription"                    value="Parse the output from HMMER3"/>
        <property name="hmmerOutputFileNameTemplate"        value="hmmer_output_[PROTSTART]_[PROTEND]"/>
        <property name="fullPathToHmmFile"                  value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.hmm"/>
        <property name="parser"                             ref="hmmer3SearchParser"/>
        <property name="serialGroup"                        value="PARSE_HMMER_3"/>
        <property name="pfamRawMatchDAO"                    ref="pfamRawMatchDAO"/>
    </bean>

    <bean id="step_pfam_A_delete_hmmer_output_file"
          class="uk.ac.ebi.interpro.scan.management.model.implementations.DeleteFileStep"
          parent="abstract_pfam_A_step"  >
        <property name="dependsUpon"                        ref="step_pfam_A_parse_HMMER3_output"/>
        <property name="stepDescription"                    value="Delete the hmmer output file following successful parsing"/>
        <property name="fileNameTemplate"                   value="hmmer_output_[PROTSTART]_[PROTEND]"/>
    </bean>

    <!-- STEP 4 -->
    <bean id="step_pfam_A_post_processing"
          class="uk.ac.ebi.interpro.scan.management.model.implementations.hmmer3.PfamA.Pfam_A_PostProcessingStep"
          parent="abstract_pfam_A_step">
        <property name="dependsUpon"                        ref="step_pfam_A_parse_HMMER3_output"/>
        <property name="stepDescription"                    value="Performs post processing on Pfam data (Hmmer 3 based)"/>
        <property name="postProcessor"                      ref="pfam_A_post_processor"/>
        <property name="serialGroup"                        value="PFAM_A_POST_PROCESSING"/>
        <property name="signatureLibraryRelease"            value="24.0"/>
        <property name="signatureLibrary"                   value="PFAM"/>
        <property name="rawMatchDAO"                        ref="pfamRawMatchDAO"/>
        <property name="filteredMatchDAO"                   ref="pfamFilteredMatchDAO"/>
    </bean>
    <!-- !!!!!!!!!!!!!!!!!!!!! JOB-END: Pfam-A !!!!!!!!!!!!!!!!!!!!!!!!!!!!  -->

    <!-- ######################## Dependencies ############################  -->
    <bean id="pfam_A_post_processor"                        class="uk.ac.ebi.interpro.scan.business.postprocessing.pfam_A.PfamHMMER3PostProcessing">
        <property name="clanFileParser"                     ref="pfam_A_clanFileParser"/>
    </bean>

    <bean id="pfam_A_clanFileParser"                        class="uk.ac.ebi.interpro.scan.business.postprocessing.pfam_A.ClanFileParser">
        <property name="pfamASeedFile"                      value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.seed"/>
        <property name="pfamCFile"                          value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-C"/>
    </bean>

    <bean id="hmmer3SearchParser" class="uk.ac.ebi.interpro.scan.io.match.hmmer3.Hmmer3SearchMatchParser">
        <property name="parserSupport"                      ref="parserSupport"/>
    </bean>

    <bean id="parserSupport" class="uk.ac.ebi.interpro.scan.io.match.hmmer3.Pfam_A_Hmmer3Hmmer3ParserSupport">
        <property name="gaValuesRetriever"                  ref="gaValuesRetriever"/>
        <property name="signatureLibraryRelease"            value="24.0"/>
        <property name="signatureLibrary"                   value="PFAM"/>
    </bean>

    <bean id="gaValuesRetriever" class="uk.ac.ebi.interpro.scan.io.model.GaValuesRetriever">
        <constructor-arg                                    value="/ebi/production/interpro/data/members/PFAM_HMMER3/24.0/Pfam-A.hmm"/>
    </bean>

    <bean id="pfamRawMatchDAO" class="uk.ac.ebi.interpro.scan.persistence.raw.PfamHmmer3RawMatchDAOImpl"/>

    <bean id="pfamFilteredMatchDAO" class="uk.ac.ebi.interpro.scan.persistence.PfamFilteredMatchDAOImpl"/>
    
    <!-- !!!!!!!!!!!!!!!!!!!!! Dependencies-END !!!!!!!!!!!!!!!!!!!!!!!!!!!!  -->
</beans>
