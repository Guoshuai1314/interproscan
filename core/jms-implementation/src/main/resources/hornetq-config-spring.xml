<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"
>

    <bean id="jmsBroker" class="uk.ac.ebi.interpro.scan.jms.broker.EmbeddedHornetQBroker">
        <property name="hornetQConfig" ref="hornetQConfig"/>
        <property name="jmsConfigFileName" value="hornetq-jms.xml"/>
    </bean>

    <bean id="hornetQConfig" class="org.hornetq.core.config.impl.ConfigurationImpl">
        <property name="managementAddress" ref="managementAddress"/>
        <property name="bindingsDirectory" value="${broker.bindings.directory}"/>
        <property name="journalDirectory" value="${broker.journal.directory}"/>
        <property name="largeMessagesDirectory" value="${broker.large.messages.directory}"/>
        <property name="pagingDirectory" value="${broker.paging.directory}"/>
        <!-- TODO - Experiment, then get rid of this override, which is overriding a recommended value. -->
        <!--<property name="connectionTTLOverride" value="600000"/>-->
        <property name="securityEnabled" value="false"/>
        <property name="connectorConfigurations">
            <map>
                <entry key="netty-connector" value-ref="nettyConnectorTransportConfiguration"/>
            </map>
        </property>
        <property name="acceptorConfigurations">
            <set>
                <ref local="nettyAcceptorTransportConfig"/>
                <ref local="inVMAcceptorTransportConfig"/>
            </set>
        </property>
    </bean>

    <bean id="managementAddress" class="org.hornetq.api.core.SimpleString">
        <constructor-arg type="java.lang.String" value="hornetq.management"/>
    </bean>

    <bean id="nettyConnectorTransportConfiguration" class="org.hornetq.api.core.TransportConfiguration">
        <constructor-arg index="0" value="org.hornetq.integration.transports.netty.NettyConnectorFactory"/>
        <constructor-arg index="1">
            <map>
                <entry key="host" value="${jms.broker.host.name}"/>
                <entry key="port" value="${jms.broker.port.number}"/>
            </map>
        </constructor-arg>
        <constructor-arg index="2" value="netty-connector"/>
    </bean>

    <!-- Default acceptor used by workers, monitors, other processes that are running in separate JVMs. -->
    <bean id="nettyAcceptorTransportConfig" class="org.hornetq.api.core.TransportConfiguration">
        <constructor-arg index="0" value="org.hornetq.integration.transports.netty.NettyAcceptorFactory"/>
        <constructor-arg index="1">
            <map>
                <entry key="host" value="${jms.broker.host.name}"/>
                <entry key="port" value="${jms.broker.port.number}"/>
            </map>
        </constructor-arg>
        <constructor-arg index="2" value="netty-acceptor"/>
    </bean>

    <!-- "In Virtual Machine" acceptor that accepts connections from the Master, running in the same JVM as the broker. -->
    <bean id="inVMAcceptorTransportConfig" class="org.hornetq.api.core.TransportConfiguration">
        <constructor-arg index="0" value="org.hornetq.core.remoting.impl.invm.InVMAcceptorFactory"/>
        <constructor-arg index="1">
            <map/>
        </constructor-arg>
        <constructor-arg index="2" value="netty-invm-acceptor"/>
    </bean>
</beans>
